<!DOCTYPE html>
<html><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Capbit</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font:14px/1.4 system-ui;background:#111;color:#eee}
nav{display:flex;flex-wrap:wrap;justify-content:center;background:#1a1a1a;border-bottom:1px solid #333;padding:0 8px;position:sticky;top:0;z-index:10}
nav button{background:none;border:none;color:#666;padding:10px 12px;cursor:pointer;font-size:13px;border-bottom:2px solid transparent;outline:none}
nav button:hover{color:#aaa}
nav button.active{color:#4a9eff;border-bottom-color:#4a9eff}
.tab{display:none;padding:20px;max-width:1000px;margin:0 auto}
.tab.active{display:block}
h2{font-size:1em;color:#888;border-bottom:1px solid #333;padding-bottom:8px;margin-bottom:12px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
details{background:#1a1a1a;border:1px solid #333;border-radius:8px}
summary{padding:10px 12px;cursor:pointer;font-size:.85em;color:#4a9eff;list-style:none}
summary::-webkit-details-marker{display:none}
summary::before{content:'â–¸ ';color:#666}
details[open] summary::before{content:'â–¾ '}
details[open] summary{border-bottom:1px solid #333}
.card{padding:12px}
label{display:block;font-size:.7em;color:#666;margin:6px 0 2px}
input{width:100%;padding:6px;background:#222;border:1px solid #444;border-radius:4px;color:#fff;font-size:12px}
input:focus{outline:none;border-color:#4a9eff}
button{padding:8px 12px;background:#4a9eff;color:#fff;border:none;border-radius:4px;cursor:pointer;font-weight:600;font-size:12px}
.card button{width:100%;margin-top:10px}
button:hover{background:#3a8eef}
button.danger{background:#c44}
button.danger:hover{background:#b33}
button.list{background:#5a5}
button.list:hover{background:#4a4}
.constants{font-size:.7em;color:#666;line-height:1.8;margin-bottom:15px}
.constants code{background:#222;padding:2px 5px;border-radius:3px;color:#888;font-size:11px}
#log-list{background:#0a0a0a;border:1px solid #333;border-radius:8px;padding:12px;min-height:300px;max-height:70vh;overflow-y:auto;font-family:monospace;font-size:11px}
.log-ok{color:#4c4}
.log-err{color:#c44}
.log-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
</style>
</head><body>
<nav>
<button class="active" onclick="tab('setup')">Setup</button>
<button onclick="tab('subjects')">Subjects</button>
<button onclick="tab('objects')">Objects</button>
<button onclick="tab('inherits')">Inherits</button>
<button onclick="tab('logs')">Logs</button>
</nav>

<div id="setup" class="tab active">
<h2>Setup</h2>
<div class="constants">
<code>_SYSTEM=1</code> <code>_ROOT=2</code> <code>_OWNER=1</code> <code>_ADMIN=2</code> <code>_EDITOR=3</code> <code>_VIEWER=4</code><br>
<code>ALL=0x3FFFFF</code> <code>ADMIN=0x3FCFCF</code> <code>EDITOR=0x366</code> <code>VIEWER=0x318</code>
</div>
<div class="grid">
<details><summary>ğŸš€ Bootstrap</summary><div class="card"><p style="font-size:11px;color:#666;margin-bottom:8px">Initialize _SYSTEM and _ROOT</p><button onclick="api('bootstrap',{})">Bootstrap</button></div></details>
<details><summary>ğŸ—‘ï¸ Clear</summary><div class="card"><p style="font-size:11px;color:#666;margin-bottom:8px">Wipe all data</p><button class="danger" onclick="api('clear',{})">Clear</button></div></details>
</div>
</div>

<div id="subjects" class="tab">
<h2>Subjects</h2>
<div class="grid">
<details><summary>âœ… Grant</summary><div class="card">
<label>Actor</label><input id="g-actor" value="2">
<label>Subject</label><input id="g-sub">
<label>Object</label><input id="g-obj" value="1">
<label>Role</label><input id="g-role">
<button onclick="api('grant',{actor:+v('g-actor'),sub:+v('g-sub'),obj:+v('g-obj'),role:+v('g-role')})">Grant</button>
</div></details>
<details><summary>âŒ Revoke</summary><div class="card">
<label>Actor</label><input id="r-actor" value="2">
<label>Subject</label><input id="r-sub">
<label>Object</label><input id="r-obj" value="1">
<label>Role</label><input id="r-role">
<button class="danger" onclick="api('revoke',{actor:+v('r-actor'),sub:+v('r-sub'),obj:+v('r-obj'),role:+v('r-role')})">Revoke</button>
</div></details>
<details><summary>ğŸ” Check</summary><div class="card">
<label>Subject</label><input id="ch-sub">
<label>Object</label><input id="ch-obj" value="1">
<label>Required (hex ok)</label><input id="ch-req" placeholder="0x4000">
<button onclick="api('check',{sub:+v('ch-sub'),obj:+v('ch-obj'),req:pm(v('ch-req'))})">Check</button>
</div></details>
<details><summary>ğŸ­ Mask</summary><div class="card">
<label>Subject</label><input id="gm-sub">
<label>Object</label><input id="gm-obj" value="1">
<button onclick="api('get_mask',{sub:+v('gm-sub'),obj:+v('gm-obj')})">Get Mask</button>
</div></details>
<details><summary>ğŸ“‹ List (subject)</summary><div class="card">
<label>Actor</label><input id="lg-actor" value="2">
<label>Subject</label><input id="lg-sub">
<button class="list" onclick="api('list_grants',{actor:+v('lg-actor'),sub:+v('lg-sub')})">â†’ (obj, role)</button>
</div></details>
<details><summary>ğŸ‘¥ List (object)</summary><div class="card">
<label>Actor</label><input id="ls-actor" value="2">
<label>Object</label><input id="ls-obj" value="1">
<button class="list" onclick="api('list_subjects',{actor:+v('ls-actor'),obj:+v('ls-obj')})">â†’ (sub, role)</button>
</div></details>
<details><summary>ğŸ·ï¸ List (sub+obj)</summary><div class="card">
<label>Actor</label><input id="lrf-actor" value="2">
<label>Subject</label><input id="lrf-sub">
<label>Object</label><input id="lrf-obj" value="1">
<button class="list" onclick="api('list_roles_for',{actor:+v('lrf-actor'),sub:+v('lrf-sub'),obj:+v('lrf-obj')})">â†’ [roles]</button>
</div></details>
</div>
</div>

<div id="objects" class="tab">
<h2>Objects</h2>
<div class="grid">
<details><summary>â• Create</summary><div class="card">
<label>Actor</label><input id="c-actor" value="2">
<label>Object</label><input id="c-obj">
<label>Role</label><input id="c-role">
<label>Mask (hex ok)</label><input id="c-mask" placeholder="0x3FFFFF">
<button onclick="api('create',{actor:+v('c-actor'),obj:+v('c-obj'),role:+v('c-role'),mask:pm(v('c-mask'))})">Create</button>
</div></details>
<details><summary>âœï¸ Update</summary><div class="card">
<label>Actor</label><input id="u-actor" value="2">
<label>Object</label><input id="u-obj">
<label>Role</label><input id="u-role">
<label>Mask (hex ok)</label><input id="u-mask">
<button onclick="api('update',{actor:+v('u-actor'),obj:+v('u-obj'),role:+v('u-role'),mask:pm(v('u-mask'))})">Update</button>
</div></details>
<details><summary>ğŸ—‘ï¸ Delete</summary><div class="card">
<label>Actor</label><input id="d-actor" value="2">
<label>Object</label><input id="d-obj">
<label>Role</label><input id="d-role">
<button class="danger" onclick="api('delete',{actor:+v('d-actor'),obj:+v('d-obj'),role:+v('d-role')})">Delete</button>
</div></details>
<details><summary>ğŸ“œ List</summary><div class="card">
<label>Actor</label><input id="lr-actor" value="2">
<label>Object</label><input id="lr-obj" value="1">
<button class="list" onclick="api('list_roles',{actor:+v('lr-actor'),obj:+v('lr-obj')})">â†’ (role, mask)</button>
</div></details>
</div>
</div>

<div id="inherits" class="tab">
<h2>Inherits</h2>
<div class="grid">
<details><summary>ğŸ”— Set</summary><div class="card">
<label>Actor</label><input id="i-actor" value="2">
<label>Subject</label><input id="i-sub">
<label>Object</label><input id="i-obj" value="1">
<label>Role</label><input id="i-role">
<label>Parent</label><input id="i-parent">
<button onclick="api('inherit',{actor:+v('i-actor'),sub:+v('i-sub'),obj:+v('i-obj'),role:+v('i-role'),parent:+v('i-parent')})">Set</button>
</div></details>
<details><summary>ğŸ”“ Remove</summary><div class="card">
<label>Actor</label><input id="ri-actor" value="2">
<label>Subject</label><input id="ri-sub">
<label>Object</label><input id="ri-obj" value="1">
<label>Role</label><input id="ri-role">
<button class="danger" onclick="api('remove_inherit',{actor:+v('ri-actor'),sub:+v('ri-sub'),obj:+v('ri-obj'),role:+v('ri-role')})">Remove</button>
</div></details>
<details><summary>ğŸ“„ List (sub+obj)</summary><div class="card">
<label>Actor</label><input id="li-actor" value="2">
<label>Subject</label><input id="li-sub">
<label>Object</label><input id="li-obj" value="1">
<button class="list" onclick="api('list_inherits',{actor:+v('li-actor'),sub:+v('li-sub'),obj:+v('li-obj')})">â†’ (role, parent)</button>
</div></details>
<details><summary>ğŸ“¦ List (object)</summary><div class="card">
<label>Actor</label><input id="lio-actor" value="2">
<label>Object</label><input id="lio-obj" value="1">
<button class="list" onclick="api('list_inherits_on_obj',{actor:+v('lio-actor'),obj:+v('lio-obj')})">â†’ (role, parent, sub)</button>
</div></details>
<details><summary>ğŸ¯ List (obj+role)</summary><div class="card">
<label>Actor</label><input id="lior-actor" value="2">
<label>Object</label><input id="lior-obj" value="1">
<label>Role</label><input id="lior-role">
<button class="list" onclick="api('list_inherits_on_obj_role',{actor:+v('lior-actor'),obj:+v('lior-obj'),role:+v('lior-role')})">â†’ (parent, sub)</button>
</div></details>
<details><summary>ğŸ‘† List (parent)</summary><div class="card">
<label>Actor</label><input id="lip-actor" value="2">
<label>Parent</label><input id="lip-parent">
<button class="list" onclick="api('list_inherits_from_parent',{actor:+v('lip-actor'),parent:+v('lip-parent')})">â†’ (obj, role, sub)</button>
</div></details>
<details><summary>ğŸ”€ List (parent+obj)</summary><div class="card">
<label>Actor</label><input id="lipo-actor" value="2">
<label>Parent</label><input id="lipo-parent">
<label>Object</label><input id="lipo-obj" value="1">
<button class="list" onclick="api('list_inherits_from_parent_on_obj',{actor:+v('lipo-actor'),parent:+v('lipo-parent'),obj:+v('lipo-obj')})">â†’ (role, sub)</button>
</div></details>
</div>
</div>

<div id="logs" class="tab">
<div class="log-header"><h2 style="border:none;margin:0;padding:0">Logs</h2><button class="danger" onclick="$('#log-list').innerHTML=''">Clear</button></div>
<div id="log-list"></div>
</div>

<script>
const $=s=>document.querySelector(s),v=id=>$('#'+id).value,pm=v=>v.startsWith('0x')?parseInt(v,16):+v;
function tab(id){document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));$('#'+id).classList.add('active');document.querySelector(`nav button[onclick="tab('${id}')"]`).classList.add('active')}
function log(ok,msg){const d=document.createElement('div');d.className=ok?'log-ok':'log-err';d.textContent=`[${new Date().toLocaleTimeString()}] ${msg}`;$('#log-list').prepend(d)}
async function api(ep,body){try{const r=await fetch('/api/'+ep,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});const j=await r.json();log(j.ok,`${ep}: ${j.msg}`)}catch(e){log(false,e.message)}}
</script>
</body></html>
